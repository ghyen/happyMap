#!/usr/bin/env python3
"""
2025년 3차 청년안심주택 PDF 파싱 스크립트
B타입 (2,3순위, 시중시세 50%) 기준으로 파싱
"""

import json
import re

# PDF에서 추출한 데이터 (수동 파싱)
# 형식: (단지명, 주소, 공급유형, 평면유형, 신청자격, 공급호수, B타입_보증금(천원), B타입_월임대료(원))

raw_data = [
    # 신규공급
    ("해링턴플레이스 노원 센트럴", "노원구 상계동 690", "26", "26.84", "청년", 9, 58000, 256000, "신규공급"),

    # 재공급
    ("L TOWER", "송파구 잠실동 208-4", "16A", "16.24", "청년", 6, 58700, 190000, "재공급"),
    ("건대입구역 더포디엄 830", "광진구 자양동 8-8", "42", "42.16", "신혼Ⅰ", 7, 118750, 524000, "재공급"),
    ("골드타워", "동작구 신대방동 351-5", "36A", "36.06", "신혼Ⅰ", 3, 90250, 399000, "재공급"),
    ("골든노블레스", "동작구 대방동 403-16", "18", "18.01", "청년", 2, 45990, 202000, "재공급"),
    ("광운대역 현대프라힐스", "노원구 월계동 410-3", "38", "38.75", "신혼Ⅰ", 3, 75000, 331000, "재공급"),
    ("구산주택", "은평구 구산동 198-3", "17A", "17.60", "청년", 2, 41820, 152000, "재공급"),
    ("구산주택", "은평구 구산동 198-3", "33B", "33.95", "청년", 1, 77340, 283000, "재공급"),
    ("길동생활A동", "강동구 길동 367-1", "17", "17.11", "청년", 20, 53250, 235000, "재공급"),
    ("길동생활B동", "강동구 길동 368-7", "36A", "36.49", "신혼Ⅰ", 2, 104750, 463000, "재공급"),
    ("길동생활B동", "강동구 길동 368-7", "36B", "36.49", "신혼Ⅰ", 2, 104750, 463000, "재공급"),
    ("더써밋 타워", "동작구 노량진동 54-1", "18A", "18.30", "청년", 1, 52750, 233000, "재공급"),
    ("더써밋 타워", "동작구 노량진동 54-1", "34A", "34.72", "신혼Ⅰ", 2, 92000, 406000, "재공급"),
    ("더원역삼", "강남구 역삼동 738-29", "17.66", "17.66", "청년", 2, 73320, 255000, "재공급"),
    ("도곡 더써밋타워", "강남구 도곡동 954-17", "18B", "18.33", "청년", 3, 71250, 315000, "재공급"),
    ("도곡 더써밋타워", "강남구 도곡동 954-17", "36A", "36.17", "신혼Ⅰ", 2, 128250, 566000, "재공급"),
    ("동대문역사문화공원역 166 tower", "중구 광희동1가 166", "14", "14.72", "청년", 1, 52500, 232000, "재공급"),
    ("라봄 성동", "성동구 마장동 339-2", "18A", "18.79", "청년", 92, 44750, 198000, "재공급"),
    ("라봄 성동", "성동구 마장동 339-2", "18B", "18.13", "청년", 4, 43250, 191000, "재공급"),
    ("리마크빌 군자", "광진구 중곡동 637-5", "16.32", "16.32", "청년", 6, 43320, 155000, "재공급"),
    ("리마크빌 군자", "광진구 중곡동 637-5", "30.41", "30.41", "청년", 1, 76080, 273000, "재공급"),
    ("리마크빌 군자", "광진구 중곡동 637-5", "32.34", "32.34", "청년", 1, 80880, 289000, "재공급"),
    ("리스트강남", "강남구 논현동 202-7", "14A-4", "14", "청년", 1, 53160, 186000, "재공급"),
    ("리스트강남", "강남구 논현동 202-7", "14C-2", "14", "청년", 1, 54930, 192000, "재공급"),
    ("리스트안암", "동대문구 제기동 136-3", "17", "17.72", "청년", 1, 43500, 192000, "재공급"),
    ("리스트안암", "동대문구 제기동 136-3", "40B", "40.58", "신혼Ⅰ", 2, 91500, 404000, "재공급"),
    ("문정역 마에스트로", "송파구 문정동 55-6", "16", "16.42", "청년", 1, 55910, 246000, "재공급"),
    ("문정역 마에스트로", "송파구 문정동 55-6", "34", "34.87", "청년", 1, 108150, 477000, "재공급"),
    ("보눔하우스 화곡", "강서구 화곡동 401-1", "15", "15.91A", "청년", 1, 28566, 93000, "재공급"),
    ("보눔하우스 화곡", "강서구 화곡동 401-1", "16", "16.90A", "청년", 1, 31233, 101000, "재공급"),
    ("비바힐스 강변", "광진구 구의동 593-11", "31", "31.77", "청년", 2, 81630, 291000, "재공급"),
    ("비바힐스 강변", "광진구 구의동 593-11", "32", "32.88", "청년", 1, 84420, 302000, "재공급"),
    ("상봉동양엔파트", "중랑구 상봉동 118-8", "18C", "18.22", "청년", 1, 39750, 176000, "재공급"),
    ("서교동 효성해링턴 타워", "마포구 서교동 395-43", "17", "17", "청년", 1, 68590, 221000, "재공급"),
    ("서교동 효성해링턴 타워", "마포구 서교동 395-43", "37A", "37A", "신혼Ⅰ", 3, 142273, 460000, "재공급"),
    ("서초꽃마을", "서초구 서초동 1502-12", "16", "16.63", "청년", 1, 45850, 145000, "재공급"),
    ("선릉역 마에스트로", "강남구 삼성동 140-32", "20A", "20A", "청년", 1, 88680, 309000, "재공급"),
    ("선릉역 마에스트로", "강남구 삼성동 140-32", "22A", "22A", "청년", 2, 97020, 339000, "재공급"),
    ("세이지움 개봉", "구로구 개봉동 403-29", "18B", "18.55", "청년", 16, 36750, 162000, "재공급"),
    ("센터스퀘어 발산", "강서구 내발산동 647-1", "36", "36.99", "신혼Ⅰ", 2, 80000, 353000, "재공급"),
    ("센터스퀘어 발산", "강서구 내발산동 647-1", "41", "41.02", "신혼Ⅰ", 3, 84000, 371000, "재공급"),
    ("센터스퀘어 서울대점", "관악구 신림동 1747", "16", "16.82", "청년", 2, 42000, 186000, "재공급"),
    ("센터스퀘어 서울대점", "관악구 신림동 1747", "22", "22.96", "청년", 1, 56500, 250000, "재공급"),
    ("센터스퀘어 서울대점", "관악구 신림동 1747", "44A", "44.62", "신혼Ⅰ", 2, 98800, 440000, "재공급"),
    ("센터스퀘어등촌", "강서구 염창동 274-17", "18", "18AA", "청년", 5, 46566, 150000, "재공급"),
    ("센텀힐스 한강", "광진구 구의동 587-62", "16.39", "16.39", "청년", 1, 45600, 162000, "재공급"),
    ("스타타워", "서대문구 남가좌동 269-1", "18", "18.01", "청년", 2, 48300, 213000, "재공급"),
    ("아르체움 등촌", "강서구 염창동 275", "20", "20.10", "청년", 5, 50000, 221000, "재공급"),
    ("어반허브 서울 스테이션", "용산구 서계동 100-1", "20A", "20.21", "청년", 1, 54500, 241000, "재공급"),
    ("어반허브 서울 스테이션", "용산구 서계동 100-1", "21A", "21.20", "청년", 4, 57250, 253000, "재공급"),
    ("어반허브 서울 스테이션", "용산구 서계동 100-1", "22", "22.02", "청년", 7, 59500, 263000, "재공급"),
    ("어반허브 서울 스테이션", "용산구 서계동 100-1", "26", "26.10", "청년", 7, 69000, 305000, "재공급"),
    ("엘크루 발산", "강서구 등촌동 671-1", "15", "15.33", "청년", 4, 49890, 120000, "재공급"),
    ("엘크루 발산", "강서구 등촌동 671-1", "30", "30.79", "청년", 1, 96390, 425000, "재공급"),
    ("옥산 그린타워", "광진구 구의동 587-64", "16", "16A", "청년", 1, 39515, 161000, "재공급"),
    ("용산 원효 루미니", "용산구 원효로1가 134", "29", "29.96", "청년", 3, 87420, 320000, "재공급"),
    ("용산베르디움프렌즈", "용산구 한강로 2가 426", "39A", "39A", "신혼Ⅰ", 3, 89030, 302000, "재공급"),
    ("우장산역해링턴타워", "강서구 화곡동 1013-3", "17", "17.74", "청년", 1, 52650, 176000, "재공급"),
    ("유벤투스 240", "관악구 신림동 1644-3", "16", "16.55", "청년", 6, 39250, 173000, "재공급"),
    ("잠실센트럴파크", "송파구 잠실동 187-10", "17", "17.25", "청년", 1, 73290, 323000, "재공급"),
    ("잠실센트럴파크", "송파구 잠실동 187-10", "21", "21.02", "청년", 3, 86620, 382000, "재공급"),
    ("잠실센트럴파크", "송파구 잠실동 187-10", "35", "35.63", "신혼Ⅰ", 1, 130200, 575000, "재공급"),
    ("잠실센트럴파크", "송파구 잠실동 187-10", "43", "43.46", "신혼Ⅰ", 2, 150150, 664000, "재공급"),
    ("제이스타 상봉", "중랑구 상봉동 109-34", "17", "17.75", "청년", 1, 43916, 156000, "재공급"),
    ("종암 라온 프라이빗", "성북구 종암동 83-3", "21", "21.82", "청년", 9, 46750, 206000, "재공급"),
    ("종암 라온 프라이빗", "성북구 종암동 83-3", "29", "29.98", "청년", 4, 63250, 279000, "재공급"),
    ("천호역한강리슈빌", "강동구 천호동 458-3", "33", "33.52", "청년", 1, 143730, 455000, "재공급"),
    ("최강타워", "관악구 신림동 1745", "39A", "39.66", "신혼Ⅰ", 1, 102900, 454000, "재공급"),
    ("최강타워", "관악구 신림동 1745", "42A", "42.72", "신혼Ⅰ", 2, 108150, 477000, "재공급"),
    ("코네스트(CONEST)", "서초구 서초동 1365-8", "17A", "17A", "청년", 5, 70290, 239000, "재공급"),
    ("태릉입구역 이니티움", "노원구 공릉동 684-41", "23", "23.98", "청년", 3, 54500, 241000, "재공급"),
    ("태릉입구역 이니티움", "노원구 공릉동 684-41", "44", "44.94", "신혼Ⅰ", 1, 93000, 411000, "재공급"),
    ("하트리움", "동대문구 휘경동 380", "33", "33.74", "청년", 1, 103950, 458000, "재공급"),
    ("호반베르디움 스테이원", "은평구 대조동 241", "17", "17.73", "청년", 1, 61210, 269000, "재공급"),
    ("호반베르디움 스테이원", "은평구 대조동 241", "21", "21.97", "청년", 7, 72970, 322000, "재공급"),
    ("호반베르디움 스테이원", "은평구 대조동 241", "24", "24.24", "청년", 1, 79060, 349000, "재공급"),
    ("홍대크리원", "마포구 상수동 355-2", "16", "16.90", "청년", 2, 55433, 180000, "재공급"),
    ("휘경제이스카이시티", "동대문구 휘경동 192-1", "14", "14.28", "청년", 2, 33758, 115000, "재공급"),
    ("힐데스하임", "성동구 용답동 233-1", "14", "14.56", "청년", 4, 59490, 207000, "재공급"),
]

def extract_district(address):
    """주소에서 자치구 추출"""
    match = re.search(r'(\S+구)', address)
    return match.group(1) if match else ""

def get_full_address(address):
    """서울특별시 포함 전체 주소 생성"""
    return f"서울특별시 {address}"

def parse_area(area_str):
    """면적 문자열을 숫자로 변환"""
    try:
        # 숫자만 추출
        match = re.search(r'[\d.]+', str(area_str))
        if match:
            return float(match.group())
    except:
        pass
    return 0.0

def main():
    properties = []
    id_counter = 1

    for item in raw_data:
        name, addr, supply_type, floor_type, qualification, units, deposit, rent, supply_category = item

        district = extract_district(addr)
        full_address = get_full_address(addr)
        area = parse_area(floor_type)

        # 공급호수만큼 개별 레코드 생성
        for i in range(units):
            unit_number = str(i + 1).zfill(2)

            property_data = {
                "id": id_counter,
                "district": district,
                "propertyId": name,
                "address": full_address,
                "unit": unit_number,
                "housingType": supply_type,
                "floorType": floor_type,
                "qualification": qualification,
                "exclusiveArea": area,
                "deposit": deposit * 1000,  # 천원 -> 원
                "monthlyRent": rent,
                "supplyType": supply_category,
                "lat": None,
                "lng": None
            }

            properties.append(property_data)
            id_counter += 1

    # JSON 저장
    output_path = "/Users/edwin/Documents/map_app/data/properties.json"
    with open(output_path, 'w', encoding='utf-8') as f:
        json.dump(properties, f, ensure_ascii=False, indent=2)

    print(f"총 {len(properties)}개 매물 저장 완료")
    print(f"저장 위치: {output_path}")

    # 통계 출력
    youth_count = sum(1 for p in properties if p["qualification"] == "청년")
    newlywed_count = sum(1 for p in properties if p["qualification"] == "신혼Ⅰ")
    new_supply = sum(1 for p in properties if p["supplyType"] == "신규공급")
    re_supply = sum(1 for p in properties if p["supplyType"] == "재공급")

    print(f"\n[통계]")
    print(f"청년: {youth_count}세대")
    print(f"신혼Ⅰ: {newlywed_count}세대")
    print(f"신규공급: {new_supply}세대")
    print(f"재공급: {re_supply}세대")

if __name__ == "__main__":
    main()
